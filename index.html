<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="icon" href="logo-sem-fundo.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrazyDog - Lanchonete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-dark: #23272f;
            --card-dark: #2d3139;
            --primary-orange: #f48c2e;
            --primary-green: #a3e635;
        }
        body { background-color: var(--bg-dark); color: white; }
        .cart-drawer { transform: translateX(100%); transition: transform 0.3s ease-in-out; }
        .cart-drawer.open { transform: translateX(0); }
        .orange-border-card { border: 2px solid var(--primary-orange); border-radius: 1.5rem; }
        @keyframes float-pulse {
            0% {
                transform: scale(1);
                filter: drop-shadow(0 0 20px rgba(244, 140, 46, 0.4));
            }
            50% {
                transform: scale(1.05) translateY(-10px);
                filter: drop-shadow(0 0 40px rgba(244, 140, 46, 0.8));
            }
            100% {
                transform: scale(1);
                filter: drop-shadow(0 0 20px rgba(244, 140, 46, 0.4));
            }
        }

        .animate-logo {
            animation: float-pulse 3s infinite ease-in-out;
        }
        @keyframes fade-slide {
            0%, 10% { opacity: 0; transform: translateX(-10px); }
            20%, 80% { opacity: 1; transform: translateX(0); }
            90%, 100% { opacity: 0; transform: translateX(-10px); }
        }

        .animate-msg {
            animation: fade-slide 5s infinite;
        }
    </style>
</head>
<body class="font-sans">

    <header class="bg-[#1a1d23] p-4 sticky top-0 z-20 shadow-lg flex justify-end items-center border-b border-gray-800">
        <div class="flex items-center gap-3">
            <a href="login.html" class="p-2 bg-[#2d3139] rounded-xl hover:bg-gray-700 transition-colors flex items-center justify-center">
                <i data-lucide="user" class="text-white"></i>
            </a>

            <button onclick="toggleCart()" class="relative p-2 bg-[#2d3139] rounded-xl hover:bg-gray-700 transition-colors flex items-center justify-center">
                <i data-lucide="shopping-cart" class="text-white"></i>
                <span id="cart-count" class="hidden absolute -top-1 -right-1 bg-[#f48c2e] text-white text-[10px] font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
        </div>
    </header>

    <!--Banner-->
    <div class="relative min-h-[400px] md:min-h-400px] bg-[#1a1d23] flex items-center justify-center overflow-hidden border-b-4 border-[#f48c2e]">
        <div class="absolute inset-0 opacity-40 bg-cover bg-center" style="background-image: url('banner.png'); filter: blur(2px);"></div>
        <div class="relative z-10 flex flex-col items-center p-6 text-center">
            <img src="logo-sem-fundo.png" 
                alt="CrazyDog Logo" 
                class="w-60 h-60 md:w-[600px] md:h-[200px] object-contain animate-logo">
            <span class="mt-4 px-9 py-2 bg-[#a3e635] text-[#1a1d23] text-xs md:text-sm font-black uppercase italic rounded-full shadow-[0_0_20px_rgba(163,230,53,0.6)] z-20">
                O melhor dog de Itapetininga
            </span>
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-[#23272f] via-transparent to-transparent z-0"></div>
    </div>

    <main class="max-w-6xl mx-auto p-6 pb-24">
        <div class="flex items-center gap-3 mb-8">
            <h3 class="text-2xl font-black uppercase italic tracking-tighter text-[#a3e635] border-b-4 border-[#f48c2e]">Nosso cardápio</h3>
        </div>

        <div id="cardapio" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
    </main>

    <div id="cart-overlay" class="fixed inset-0 bg-black/80 z-20 hidden backdrop-blur-sm" onclick="toggleCart()"></div>
    <div id="cart-drawer" class="cart-drawer fixed right-0 top-0 h-full w-full max-w-lg bg-[#1a1d23] shadow-2xl z-30 flex flex-col">
        <div class="p-6 flex justify-between items-center border-b border-gray-800">
            <h2 class="font-black italic uppercase text-[#f48c2e]">Seu Pedido</h2>
            <button onclick="toggleCart()" class="text-gray-500 hover:text-white"><i data-lucide="x"></i></button>
        </div>
        
        <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

        <div class="p-6 bg-[#16191e] border-t border-gray-800">
            <div class="flex justify-between items-center mb-6">
                <span class="text-gray-500 font-bold uppercase text-xs">Total:</span>
                <span id="cart-total" class="text-2xl font-black text-[#a3e635]">R$ 0,00</span>
            </div>
            <div class="mb-6 p-4 bg-[#23272f] rounded-2xl border border-gray-800">
                <label class="block text-[10px] font-black uppercase text-gray-500 mb-3 tracking-widest text-center">Como deseja receber?</label>
                <div class="flex gap-2">
                    <label class="flex-1 flex flex-col items-center p-3 rounded-xl border-2 border-gray-700 cursor-pointer hover:bg-gray-800 transition-all has-[:checked]:border-[#a3e635] has-[:checked]:bg-[#a3e635]/10">
                        <input type="radio" name="tipo_entrega" value="Entrega" checked class="hidden">
                        <i data-lucide="truck" class="w-5 h-5 mb-1 text-white"></i>
                        <span class="text-[9px] font-black uppercase">Entrega</span>
                    </label>
                    
                    <label class="flex-1 flex flex-col items-center p-3 rounded-xl border-2 border-gray-700 cursor-pointer hover:bg-gray-800 transition-all has-[:checked]:border-[#f48c2e] has-[:checked]:bg-[#f48c2e]/10">
                        <input type="radio" name="tipo_entrega" value="Retirada" class="hidden">
                        <i data-lucide="package-search" class="w-5 h-5 mb-1 text-white"></i>
                        <span class="text-[9px] font-black uppercase">Retirada</span>
                    </label>
                </div>
            </div>
            <button id="btn-finalizar" onclick="finalizarPedido()" disabled class="w-full py-4 rounded-2xl font-black uppercase tracking-widest transition-all bg-gray-700 text-gray-500">
                Finalizar Pedido
            </button>
        </div>
    </div>

    <script>
 // 1. Configuração do Supabase
        const supabaseUrl = 'https://fxmivhmbilnfkxusaxid.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4bWl2aG1iaWxuZmt4dXNheGlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4OTE1MjcsImV4cCI6MjA4NzQ2NzUyN30.dslzpVwwI3Kua52dS1JpD5SrbkSNm68dED7nToLw2nM';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        // 2. Variáveis Globais
        let LANCHES = [];
        let carrinho = [];

        // 3. Buscar Dados do Supabase
        async function buscarLanchesDoBanco() {
            const { data, error } = await supabaseClient
                .from('lanches')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error("Erro ao buscar lanches:", error.message);
                document.getElementById('cardapio').innerHTML = `<p class="text-red-500 text-xs italic">Erro ao carregar cardápio.</p>`;
            } else {
                LANCHES = data;
                renderizarCardapio();
            }
        }

        // 4. Funções de Interface
        function renderizarCardapio() {
            const container = document.getElementById('cardapio');
            // Verifique se no banco os nomes estão exatamente assim (maiúsculas/minúsculas)
            const categoriasParaFiltrar = ['Lanche', 'Doce', 'Bebida', 'Adicional'];
            
            if (LANCHES.length === 0) {
                container.innerHTML = `<p class="col-span-full text-center text-gray-500 italic">Nenhum item disponível.</p>`;
                return;
            }

            container.innerHTML = ''; 

            categoriasParaFiltrar.forEach(cat => {
                const itensFiltrados = LANCHES.filter(item => item.categoria === cat);
                
                if (itensFiltrados.length > 0) {
                    // Título formatado para o cliente
                    const nomesExibicao = { 'Lanche': 'Lanches', 'Doce': 'Doces', 'Bebida': 'Bebidas','Adicional':'Adicionais'};
                    
                    // Criamos uma seção inteira para a categoria
                    const HTMLCategoria = `
                        <div class="col-span-full w-full mt-10 mb-4 border-l-4 border-[#f48c2e] pl-4">
                            <h3 class="text-2xl font-black uppercase italic tracking-tighter text-[#a3e635]">
                                ${nomesExibicao[cat]}
                            </h3>
                        </div>
                        
                        ${itensFiltrados.map(item => `
                            <div class="orange-border-card bg-[#2d3139] overflow-hidden group h-full flex flex-col">
                                <div class="h-48 overflow-hidden relative">
                                    <img src="${item.imagem}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 opacity-80">
                                </div>
                                <div class="p-6 flex-1 flex flex-col">
                                    <h4 class="text-lg font-black uppercase italic">${item.nome}</h4>
                                    <p class="text-gray-400 text-xs mt-2 mb-4 leading-tight flex-1">${item.descricao || 'Sem descrição.'}</p>
                                    <div class="flex justify-between items-center mt-auto">
                                        <span class="text-[#a3e635] font-black text-xl">R$ ${parseFloat(item.preco).toFixed(2)}</span>
                                        <button onclick="adicionarNoCarrinho(${item.id})" class="bg-[#f48c2e] hover:bg-orange-600 text-white p-3 rounded-xl transition-all active:scale-90">
                                            <i data-lucide="plus" size="20"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    `;
                    
                    container.innerHTML += HTMLCategoria;
                }
            });

            lucide.createIcons();
        }

        function toggleCart() {
            document.getElementById('cart-drawer').classList.toggle('open');
            document.getElementById('cart-overlay').classList.toggle('hidden');
        }

        // 5. Lógica do Carrinho
        function adicionarNoCarrinho(id) {
            const itemOriginal = LANCHES.find(l => l.id == id);
            
            if (itemOriginal) {
                // Criamos uma cópia para poder adicionar a observação sem afetar o objeto original
                const novoItem = { ...itemOriginal, observacao: "" };
                carrinho.push(novoItem);
                atualizarCarrinho();
                if(!document.getElementById('cart-drawer').classList.contains('open')) toggleCart();
            }
        }

        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarCarrinho();
        }

        function atualizarCarrinho() {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countEl = document.getElementById('cart-count');
            const btnFinalizar = document.getElementById('btn-finalizar');

            if(carrinho.length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center uppercase font-bold text-[10px] mt-10 tracking-widest">Carrinho vazio</p>';
                btnFinalizar.disabled = true;
                btnFinalizar.className = "w-full py-4 rounded-2xl font-black uppercase tracking-widest bg-gray-800 text-gray-600 cursor-not-allowed";
                countEl.classList.add('hidden');
            } else {
                container.innerHTML = carrinho.map((item, index) => `
                    <div class="bg-[#23272f] p-6 rounded-2xl border border-gray-800 flex flex-col gap-5 shadow-lg">
                    <div class="flex items-center justify-between gap-4">
                        <div class="flex-1">
                            <p class="font-black text-lg uppercase italic text-white leading-tight tracking-tight">
                                ${item.nome}
                            </p>
                            <p class="text-[#f48c2e] font-black text-sm mt-1">
                                R$ ${parseFloat(item.preco).toFixed(2)}
                            </p>
                        </div>
                        <button onclick="removerDoCarrinho(${index})" class="p-3 bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500 hover:text-white transition-all">
                            <i data-lucide="trash-2" size="20"></i>
                        </button>
                    </div>
                    
                    <div class="relative">
                        <textarea 
                            placeholder="Ex: Tirar cebola, refri gelado..." 
                            onchange="salvarObservacao(${index}, this.value)"
                            class="w-full bg-[#1a1d23] border border-gray-700 p-4 rounded-xl text-sm text-gray-200 outline-none focus:border-[#a3e635] transition-all min-h-[80px] resize-none"
                        >${item.observacao || ''}</textarea>
                    </div>
                </div>
            `).join('');
                btnFinalizar.disabled = false;
                btnFinalizar.className = "w-full py-4 rounded-2xl font-black uppercase tracking-widest bg-[#a3e635] text-[#1a1d23] hover:shadow-[0_0_20px_rgba(163,230,53,0.5)] transition-all";
                countEl.classList.remove('hidden');
                countEl.innerText = carrinho.length;
            }

            const total = carrinho.reduce((acc, item) => acc + parseFloat(item.preco), 0);
            totalEl.innerText = `R$ ${total.toFixed(2)}`;
            lucide.createIcons();
        }

        function finalizarPedido() {
            // 1. Pega o tipo de entrega escolhido
            const tipoEntrega = document.querySelector('input[name="tipo_entrega"]:checked').value;
            const total = carrinho.reduce((acc, item) => acc + parseFloat(item.preco), 0);
            
            // 2. Define as categorias na ordem que você quer que apareça
            const categorias = ['Lanche', 'Doce', 'Bebida', 'Adicional'];
            let itensTexto = "";

            // 3. Monta a mensagem separando por categoria
            const nomesPlural = {
                'Lanche': 'LANCHES',
                'Doce': 'DOCES',
                'Bebida': 'BEBIDAS',
                'Adicional': 'ADICIONAIS' // Aqui está a correção
            };

            categorias.forEach(cat => {
                const itensDaCat = carrinho.filter(i => i.categoria === cat);
                
                if (itensDaCat.length > 0) {
                    // Usamos o mapeamento para pegar o nome correto em vez de apenas somar "S"
                    const tituloCorreto = nomesPlural[cat] || cat.toUpperCase() + 'S';
                    itensTexto += `\n*${tituloCorreto}:*\n`;
                    
                    itensDaCat.forEach(i => {
                        itensTexto += `• ${i.nome} - R$ ${parseFloat(i.preco).toFixed(2)}`;
                        if (i.observacao) {
                            const obsLimpa = i.observacao.trim();
                            itensTexto += `\n   ┗ Obs: ${obsLimpa}`;
                        }
                        itensTexto += `\n`;
                    });
                }
            });

            // 4. Monta a mensagem final completa
            const msg = `*CRAZY DOG - NOVO PEDIDO*
        ------------------------------
        ${itensTexto}
        ------------------------------
        *FORMA:* ${tipoEntrega.toUpperCase()}
        *TOTAL:* R$ ${total.toFixed(2)}
        ------------------------------
        `;

            // 5. Envia para o WhatsApp
            const mensagemCodificada = encodeURIComponent(msg);
            const whatsappLink = `https://wa.me/5515981033150?text=${mensagemCodificada}`;

            window.open(whatsappLink, '_blank');
        }

        // 6. Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            buscarLanchesDoBanco();
            lucide.createIcons();
        });  
        
        function salvarObservacao(index, texto) {
            carrinho[index].observacao = texto;
        }
    </script>
</body>
    <!--<div class="fixed bottom-8 left-8 z-50 flex items-center">
        
        <div class="absolute left-32 bg-white text-[#1a1d23] px-4 py-2 rounded-2xl rounded-bl-none shadow-xl border-2 border-[#a3e635] animate-msg w-max">
            <p class="text-[13px] font-black uppercase tracking-tighter">Precisa de ajuda?</p>
        </div>
        
        <a href="https://wa.me/5515981033150?text=Olá! Preciso de ajuda com o cardápio." 
        target="_blank" 
        class="w-32 h-32 bg-[#a3e635] rounded-full p-1 shadow-2xl hover:scale-110 transition-transform active:scale-95 flex items-center justify-center overflow-hidden border-4 border-white">
            <img src="avatar-sem-fundo.png" alt="Assistente CrazyDog" class="w-full h-full object-contain">
        </a>
    </div>-->
    <div id="avatar-container" class="fixed bottom-6 left-6 z-10 flex items-center transition-opacity duration-300">
        
        <div class="absolute left-32 bg-white text-[#1a1d23] px-4 py-2 rounded-2xl rounded-bl-none shadow-xl border-2 border-[#a3e635] animate-msg w-max hidden md:block">
            <p class="text-[11px] font-black uppercase tracking-tighter">Precisa de ajuda?</p>
        </div>
        
        <a href="https://wa.me/5515981033150?text=Olá! Preciso de ajuda com o cardápio." 
        target="_blank" 
        class="w-20 h-20 md:w-32 md:h-32 bg-[#a3e635] rounded-full p-1 shadow-2xl hover:scale-110 transition-transform active:scale-95 flex items-center justify-center overflow-hidden border-4 border-white">
            <img src="avatar-sem-fundo.png" alt="Assistente CrazyDog" class="w-full h-full object-contain">
        </a>
    </div>
    <footer class="mt-auto py-10 border-t border-gray-800 bg-[#1a1d23]">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            
            <div class="flex flex-col items-center md:items-start">
                <!--
                <h4 class="text-[#f48c2e] font-black uppercase italic tracking-tighter text-lg">CrazyDog</h4>
                <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest mt-1">O melhor dog de Itapetininga</p>
                -->
            </div>

            <div class="text-center">
                <p class="text-gray-400 text-xs font-medium">
                    &copy; 2026 <span class="text-white">Jairo Alencar</span>. Todos os direitos reservados.
                </p>
            </div>

            <div class="flex gap-4">
                <!--
                <a href="#" class="text-gray-500 hover:text-[#a3e635] transition-colors"><i data-lucide="instagram" size="18"></i></a>
                <a href="#" class="text-gray-500 hover:text-[#a3e635] transition-colors"><i data-lucide="facebook" size="18"></i></a>
                -->
            </div>
        </div>
    </footer>
</html>